{% extends "base.html" %}

{% block title %}Edit Application{% endblock %}

{% block content %}

<h1 style="text-align:center; margin-bottom:1.5rem;">Edit Application</h1>

<div class="form-container">

    <form method="POST" action="{{ url_for('update_application', app_id=app.app_id) }}">

        <!-- UNIVERSITY & COURSE INFO -->
        <h2 class="form-section-title">University & Course Details</h2>

        <div class="form-group typeahead">
            <label>Country</label>
            <input type="text" id="country_name" name="country_name"
                   autocomplete="off" required
                   value="{{ app.country_name }}">
            <div class="dropdown-list" id="country_dropdown"></div>
        </div>

        <div class="form-group typeahead">
            <label>University Name</label>
            <input type="text" id="university_name" name="university_name"
                   autocomplete="off" required
                   value="{{ app.university_name }}">
            <div class="dropdown-list" id="university_dropdown"></div>
        </div>

        <div class="form-group">
            <label>Course Name</label>
            <input type="text" name="course_name" required value="{{ app.course_name }}">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Degree Type</label>
                <input type="text" name="degree_type" value="{{ app.degree_type }}">
            </div>

            <div class="form-group">
                <label>Course URL</label>
                <input type="text" name="course_url" value="{{ app.course_url }}">
            </div>
        </div>

        <!-- INTAKE & DEADLINES -->
        <h2 class="form-section-title">Intake & Deadlines</h2>

        <div class="form-row">
            <div class="form-group">
                <label>Intake Type</label>
                <select name="intake_type">
                    <option value=""></option>
                    <option value="Winter" {% if app.intake_type=='Winter' %}selected{% endif %}>Winter</option>
                    <option value="Summer" {% if app.intake_type=='Summer' %}selected{% endif %}>Summer</option>
                </select>
            </div>

            <div class="form-group">
                <label>Intake Year</label>
                <input type="number" name="intake_year"
                       min="2024" max="2035" value="{{ app.intake_year }}">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Application Opens</label>
                <input type="date" name="application_open_date"
                       value="{{ app.application_open_date }}">
            </div>

            <div class="form-group">
                <label>Deadline</label>
                <input type="date" name="deadline_date"
                       value="{{ app.deadline_date }}">
            </div>
        </div>

        <!-- REQUIREMENTS -->
        <h2 class="form-section-title">Requirements</h2>

        <div class="form-row">
            <div class="form-group">
                <label>IELTS Required</label>
                <input type="number" step="0.5" name="ielts_required"
                       value="{{ app.ielts_required }}">
            </div>

            <div class="form-group">
                <label>German Required</label>
                <input type="text" name="german_required"
                       value="{{ app.german_required }}">
            </div>
        </div>

        <div class="form-group">
            <label>Extra Requirements</label>
            <textarea name="extra_requirements">{{ app.extra_requirements }}</textarea>
        </div>

        <!-- APPLICATION MODE -->
        <h2 class="form-section-title">Application Mode</h2>

        <div class="form-row">

            <div class="form-group">
                <label>Mode</label>
                <select name="application_mode">
                    <option value=""></option>
                    <option value="Direct" {% if app.application_mode=='Direct' %}selected{% endif %}>Direct</option>
                    <option value="UniAssist" {% if app.application_mode=='UniAssist' %}selected{% endif %}>UniAssist</option>
                    <option value="Other" {% if app.application_mode=='Other' %}selected{% endif %}>Other</option>
                </select>
            </div>

            <div class="form-group">
                <label>Portal Email</label>
                <input type="email" name="portal_email" value="{{ app.portal_email }}">
            </div>

            <div class="form-group">
                <label>Password Hint</label>
                <input type="text" name="portal_password_hint"
                       value="{{ app.portal_password_hint }}">
            </div>
        </div>

        <!-- STATUS & SUBMISSION INFO -->
        <h2 class="form-section-title">Status & Submission</h2>

        <div class="form-group">
            <label>Status</label>
            <select name="status" id="status" required>
                <option value=""></option>
                <option value="shortlisted" {% if app.status=='shortlisted' %}selected{% endif %}>Shortlisted</option>
                <option value="preparing" {% if app.status=='preparing' %}selected{% endif %}>Preparing</option>
                <option value="submitted" {% if app.status=='submitted' %}selected{% endif %}>Submitted</option>
                <option value="admitted" {% if app.status=='admitted' %}selected{% endif %}>Admitted</option>
                <option value="rejected" {% if app.status=='rejected' %}selected{% endif %}>Rejected</option>
            </select>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Date Submitted</label>
                <input type="date" name="date_submitted" id="date_submitted"
                       value="{{ app.date_submitted }}">
            </div>

            <div class="form-group">
                <label>Time Submitted</label>
                <input type="time" name="time_submitted" id="time_submitted"
                       value="{{ app.time_submitted }}">
            </div>

            <div class="form-group">
                <label>Decision Date</label>
                <input type="date" name="decision_date" id="decision_date"
                       value="{{ app.decision_date }}">
            </div>
        </div>

        <!-- EXTRA INFO -->
        <h2 class="form-section-title">Extra Info</h2>

        <div class="form-group">
            <textarea name="extra_info">{{ app.extra_info }}</textarea>
        </div>

        <button type="submit" class="btn btn-primary">Update Application</button>
        <a href="{{ url_for('application_details', app_id=app.app_id) }}" class="btn btn-outline">Cancel</a>

    </form>

</div>

<script>
// SAME TYPEAHEAD LOGIC - REUSED EXACTLY
setupTypeahead("country_name", "country_dropdown", "/api/country_suggest");
setupTypeahead("university_name", "university_dropdown", "/api/university_suggest");

// Status logic (same as add form)
document.getElementById("status").addEventListener("change", function () {
    const status = this.value;

    const submitEnabled = ["submitted", "admitted", "rejected"].includes(status);
    const decisionEnabled = ["admitted", "rejected"].includes(status);

    document.getElementById("date_submitted").disabled = !submitEnabled;
    document.getElementById("time_submitted").disabled = !submitEnabled;
    document.getElementById("decision_date").disabled = !decisionEnabled;

    if (!submitEnabled) {
        document.getElementById("date_submitted").value = "";
        document.getElementById("time_submitted").value = "";
    }

    if (!decisionEnabled) {
        document.getElementById("decision_date").value = "";
    }
});
</script>

{% endblock %}
